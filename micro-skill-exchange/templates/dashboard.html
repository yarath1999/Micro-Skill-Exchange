<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Dashboard</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='dashboard_styles.css') }}" />
  <style>
    /* New style for applied button */
    button.btn.btn-apply.btn-applied {
      background-color: #aaa !important; /* Grey background */
      cursor: not-allowed !important;
      color: white !important;
      border: none !important;
    }
  </style>
</head>

<body class="{% if user.role == 'seeker' %}seeker-theme{% endif %}">
<div class="dashboard-header">
  <div class="dashboard-title">Opportunities</div>

  <div class="dashboard-actions">
    {% if user.role.lower() == 'seeker' %}
      <a href="{{ url_for('my_applications') }}" class="btn btn-view">My Applications</a>
    {% endif %}
    
    {% if user.role == 'provider' %}
      <a href="{{ url_for('add_opportunity') }}" class="btn btn-add">Add Opportunity</a>
    {% endif %}
  </div>
</div>

    {% if user.role.lower() == 'seeker' %}
    <!-- Filter Section for Seekers -->
    <div class="filter-section">
      <div class="dropdown">
        <button class="dropdown-btn" onclick="toggleDropdown()">Select Skills</button>
        <div id="dropdownContent" class="dropdown-content">
          <label><input type="checkbox" value="web development" onchange="filterBySkills()"> Web Development</label>
          <label><input type="checkbox" value="graphic design" onchange="filterBySkills()"> Graphic Design</label>
          <label><input type="checkbox" value="content writing" onchange="filterBySkills()"> Content Writing</label>
          <label><input type="checkbox" value="digital marketing" onchange="filterBySkills()"> Digital Marketing</label>
          <label><input type="checkbox" value="data entry" onchange="filterBySkills()"> Data Entry</label>
          <label><input type="checkbox" value="cashier" onchange="filterBySkills()"> Cashier</label>
          <label><input type="checkbox" value="receptionist" onchange="filterBySkills()"> Receptionist</label>
        </div>
      </div>
    </div>
    {% endif %}

    <div id="opportunitiesList">
      {% for opportunity in opportunities %}
      <div class="opportunity-card" data-skills="{{ opportunity.title | lower }}">
        <div class="opportunity-title">{{ opportunity.title }}</div>
        <div class="opportunity-description">{{ opportunity.description }}</div>
        <div class="opportunity-location">üìç {{ opportunity.location }}</div>

        <div class="btn-group">
          {% if user.role == 'seeker' %}
            <form action="{{ url_for('apply_opportunity', opportunity_id=opportunity.id) }}" method="post" style="display:inline;">
              <button 
                type="submit" 
                class="btn btn-apply {% if opportunity.id in applied_opportunity_ids %}btn-applied{% endif %}"
                {% if opportunity.id in applied_opportunity_ids %}disabled{% endif %}
              >
                {% if opportunity.id in applied_opportunity_ids %}
                  Applied
                {% else %}
                  Apply
                {% endif %}
              </button>
            </form>
            <button class="btn btn-view" onclick="openModal('{{ opportunity.title }}', '{{ opportunity.description }}', '{{ opportunity.location }}')">View Details</button>

          {% elif user.role == 'provider' and opportunity.created_by == user.id %}
            <a href="{{ url_for('edit_opportunity', id=opportunity.id) }}" class="btn btn-edit">Edit</a>

            <form action="{{ url_for('delete_opportunity', id=opportunity.id) }}" method="post" style="display:inline;">
              <button type="submit" class="btn btn-remove" onclick="return confirm('Are you sure you want to delete this opportunity?')">Remove</button>
            </form>
          {% endif %}
        </div>
      </div>
      {% endfor %}
    </div>
  </div>

  <!-- Modal Popup -->
  <div id="opportunityModal" class="modal" style="display:none;">
    <div class="modal-content">
      <span class="close" onclick="closeModal()">&times;</span>
      <h2 id="modalTitle"></h2>
      <p id="modalDescription"></p>
      <p id="modalLocation"></p>
    </div>
  </div>

  <script>
    function toggleDropdown() {
      const dropdown = document.getElementById('dropdownContent');
      dropdown.style.display = dropdown.style.display === 'block' ? 'none' : 'block';
    }

    function filterBySkills() {
      const checkboxes = document.querySelectorAll('#dropdownContent input[type="checkbox"]');
      const selectedSkills = Array.from(checkboxes)
        .filter(checkbox => checkbox.checked)
        .map(checkbox => checkbox.value.toLowerCase());

      const cards = document.querySelectorAll('.opportunity-card');
      cards.forEach(card => {
        const skills = card.getAttribute('data-skills') || '';
        const show = selectedSkills.length === 0 || selectedSkills.some(skill => skills.includes(skill));
        card.style.display = show ? 'block' : 'none';
      });
    }

    window.onclick = function(event) {
      const modal = document.getElementById('opportunityModal');
      if (event.target == modal) {
        closeModal();
      }
      if (!event.target.matches('.dropdown-btn')) {
        const dropdowns = document.getElementsByClassName("dropdown-content");
        for (let i = 0; i < dropdowns.length; i++) {
          let openDropdown = dropdowns[i];
          if (openDropdown.style.display === 'block') {
            openDropdown.style.display = 'none';
          }
        }
      }
    }

    function openModal(title, description, location) {
      document.getElementById('modalTitle').innerText = title;
      document.getElementById('modalDescription').innerText = description;
      document.getElementById('modalLocation').innerText = "Location: " + location;
      document.getElementById('opportunityModal').style.display = 'flex';
    }

    function closeModal() {
      document.getElementById('opportunityModal').style.display = 'none';
    }
  </script>

</body>
</html>
